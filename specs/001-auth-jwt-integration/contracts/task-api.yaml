# API Contract: Secure Task Management with JWT Authentication

## Overview
All endpoints require a valid JWT token in the Authorization header. The token must be obtained through Better Auth's authentication flow.

## Authentication
All requests must include an Authorization header with the format:
```
Authorization: Bearer <jwt-token>
```

## Endpoints

### List User Tasks
```
GET /api/{user_id}/tasks
Authorization: Bearer <jwt-token>
```

**Success Response (200):**
```json
{
  "tasks": [
    {
      "id": "task-uuid",
      "title": "Task title",
      "description": "Task description",
      "completed": false,
      "user_id": "user-uuid",
      "created_at": "2025-12-15T10:30:00Z",
      "updated_at": "2025-12-15T10:30:00Z",
      "due_date": "2025-12-20T10:30:00Z"
    }
  ]
}
```

**Error Responses:**
- 401: Invalid or missing token
- 403: User attempting to access another user's tasks
- 404: User ID not found

### Create Task
```
POST /api/{user_id}/tasks
Authorization: Bearer <jwt-token>
Content-Type: application/json
```

**Request Body:**
```json
{
  "title": "New task title",
  "description": "Task description",
  "due_date": "2025-12-20T10:30:00Z"
}
```

**Success Response (201):**
```json
{
  "id": "new-task-uuid",
  "title": "New task title",
  "description": "Task description",
  "completed": false,
  "user_id": "user-uuid",
  "created_at": "2025-12-15T10:30:00Z",
  "updated_at": "2025-12-15T10:30:00Z",
  "due_date": "2025-12-20T10:30:00Z"
}
```

**Error Responses:**
- 401: Invalid or missing token
- 403: User attempting to create task for another user
- 422: Validation error in request body

### Get Task Details
```
GET /api/{user_id}/tasks/{task_id}
Authorization: Bearer <jwt-token>
```

**Success Response (200):**
```json
{
  "id": "task-uuid",
  "title": "Task title",
  "description": "Task description",
  "completed": false,
  "user_id": "user-uuid",
  "created_at": "2025-12-15T10:30:00Z",
  "updated_at": "2025-12-15T10:30:00Z",
  "due_date": "2025-12-20T10:30:00Z"
}
```

**Error Responses:**
- 401: Invalid or missing token
- 403: User attempting to access another user's task
- 404: Task or user not found

### Update Task
```
PUT /api/{user_id}/tasks/{task_id}
Authorization: Bearer <jwt-token>
Content-Type: application/json
```

**Request Body:**
```json
{
  "title": "Updated task title",
  "description": "Updated description",
  "completed": true,
  "due_date": "2025-12-20T10:30:00Z"
}
```

**Success Response (200):**
```json
{
  "id": "task-uuid",
  "title": "Updated task title",
  "description": "Updated description",
  "completed": true,
  "user_id": "user-uuid",
  "created_at": "2025-12-15T10:30:00Z",
  "updated_at": "2025-12-15T11:30:00Z",
  "due_date": "2025-12-20T10:30:00Z"
}
```

**Error Responses:**
- 401: Invalid or missing token
- 403: User attempting to update another user's task
- 404: Task or user not found
- 422: Validation error in request body

### Delete Task
```
DELETE /api/{user_id}/tasks/{task_id}
Authorization: Bearer <jwt-token>
```

**Success Response (204):**
No content returned

**Error Responses:**
- 401: Invalid or missing token
- 403: User attempting to delete another user's task
- 404: Task or user not found

### Toggle Task Completion
```
PATCH /api/{user_id}/tasks/{task_id}/toggle
Authorization: Bearer <jwt-token>
Content-Type: application/json
```

**Request Body:**
```json
{
  "completed": true
}
```

**Success Response (200):**
```json
{
  "id": "task-uuid",
  "title": "Task title",
  "description": "Task description",
  "completed": true,
  "user_id": "user-uuid",
  "created_at": "2025-12-15T10:30:00Z",
  "updated_at": "2025-12-15T11:30:00Z",
  "due_date": "2025-12-20T10:30:00Z"
}
```

**Error Responses:**
- 401: Invalid or missing token
- 403: User attempting to toggle another user's task
- 404: Task or user not found